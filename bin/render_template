#!/usr/bin/env node
var async = require("async");
var config = require("config3");
var fs = require("fs");
var mustache = require("mustache");
var inPath = process.argv[2];

function render(inPath, callback) {
  var outPath = inPath.replace(".mustache", "");
  if (outPath === inPath) {
    callback(new Error("Template paths must end in .mustache file extension"));
    return;
  }
  fs.readFile(inPath, "utf8", function (error, must) {
    if (error) {
      callback(error);
      return;
    }
    var output = mustache.render(must, config);
    fs.writeFile(outPath, output, callback);
  });
}

async.eachLimit(process.argv.slice(2), 10, render, function (error, result) {
  if (error) {
    console.error(error);
    return;
  }
});
