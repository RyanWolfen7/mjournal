#!/bin/sh
cd $(dirname "${0}")/..
case "${1}" in
  build)
    find app/components -type f -name \*.coffee | xargs coffee -c
    find app/components -type f -name \*.styl | xargs stylus
    component build
  ;;
  start)
   [ ! -d node_modules ] && npm install
   exec coffee --nodejs --debug=9091 ./app/server.coffee
  ;;
  inspector)
    exec node-inspector --web-port=9092
  ;;
  test)
    exec ./dev/bin/test.sh "${@}"
  ;;
  testdebug)
    exec ./bin/test.sh --debug
  ;;
  clean)
   rm -rf ./build
  ;;
  postgres)
    pg_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start
  ;;
  *)
    for EXT in sh js
    do
      SUB="./dev/bin/${1}.${EXT}"
      if [ -x "${SUB}" ]; then
        exec "${SUB}" "${@}"
      fi
    done
    echo "Unknown command ${1}" 1>&2
    exit 1
  ;;
esac
